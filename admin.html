<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epplicon CMS - Admin Panel</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Colors - Blue Theme */
            --primary: #2563eb;
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --primary-lightest: #dbeafe;
            
            --success: #10b981;
            --success-color: #10b981;
            --warning: #f59e0b;
            --warning-color: #f59e0b;
            --danger: #ef4444;
            --danger-color: #ef4444;
            --info: #06b6d4;
            --info-color: #06b6d4;
            
            /* Status Colors */
            --success-light: #d1fae5;
            --warning-light: #fef3c7;
            --danger-light: #fee2e2;
            --info-light: #cffafe;
            --primary-blue-lightest: #dbeafe;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --border-light: #e5e7eb;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            --white: #ffffff;
            
            /* Aliases for admin-client-portal.js compatibility */
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --background-color: #f9fafb;
            --border-color: #e5e7eb;
            --surface-color: #ffffff;
            
            /* Compact Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            
            /* Spacing aliases */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 0.75rem;
            --spacing-lg: 1rem;
            --spacing-xl: 1.25rem;
            --spacing-2xl: 1.5rem;
            
            /* Borders & Radius */
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-blue: 0 10px 25px -5px rgba(37, 99, 235, 0.3);
            
            /* Transitions */
            --transition-base: all 0.2s ease;
        }
        
        body {
        font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .hidden { display: none !important; }
        
        /* ============ LOGIN VIEW ============ */
        #login-view {
        display: flex;
        align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-4);
        }
        
        .login-card {
            background: var(--white);
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
        }
        
        .login-card h1 {
            color: var(--primary);
            font-size: 1.75rem;
            margin-bottom: var(--space-4);
            text-align: center;
        }
        
        .form-group {
            margin-bottom: var(--space-4);
        }
        
        .form-group label {
        display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
        }
        
        .form-control {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-lightest);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-block { width: 100%; }
        .btn-sm { padding: var(--space-1) var(--space-3); font-size: 0.875rem; }
        .btn-secondary { background: var(--gray-600); }
        .btn-secondary:hover { background: var(--gray-700); }
        .btn-success { background: var(--success); }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: var(--warning); }
        .btn-warning:hover { background: #d97706; }
        
        .alert {
            padding: var(--space-3);
            border-radius: var(--radius);
            font-size: 0.875rem;
            margin-top: var(--space-3);
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        /* ============ ADMIN LAYOUT ============ */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 220px;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--primary);
            margin-bottom: var(--space-4);
        }
        
        .sidebar-header h1 {
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .nav-menu {
            flex: 1;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            color: var(--gray-600);
            text-decoration: none;
            border-radius: var(--radius);
            font-size: 0.9375rem;
            font-weight: 500;
            margin-bottom: var(--space-1);
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }
        
        .nav-link.active {
            background: var(--primary);
            color: var(--white);
        }
        
        .nav-link i {
            width: 18px;
            text-align: center;
        }
        
        .main-content {
            flex: 1;
            padding: var(--space-5) var(--space-4);
            overflow-y: auto;
        }
        
        /* ============ CARDS ============ */
        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        /* ============ DASHBOARD ============ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            gap: var(--space-3);
        }
        
        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
        }
        
        .page-subtitle {
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-top: var(--space-1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .stat-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: currentColor;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-card.blue { color: var(--primary); }
        .stat-card.green { color: var(--success); }
        .stat-card.orange { color: var(--warning); }
        .stat-card.purple { color: #8b5cf6; }
        .stat-card.teal { color: #14b8a6; }
        
        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius);
            background: currentColor;
            opacity: 0.1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .stat-icon i {
            color: currentColor;
            opacity: 1;
            font-size: 1.25rem;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
        }
        
        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: var(--space-1);
        }
        
        .stat-hint {
            color: var(--gray-400);
            font-size: 0.75rem;
        }
        
        /* Quick Actions */
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .section-title i {
            color: var(--primary);
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-2);
        }
        
        .action-btn {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            padding: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .action-btn:hover {
            border-color: var(--primary);
            background: var(--primary-lightest);
            transform: translateY(-1px);
        }
        
        .action-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .action-text strong {
            display: block;
            color: var(--gray-900);
            font-size: 0.9375rem;
            margin-bottom: 2px;
        }
        
        .action-text small {
            color: var(--gray-500);
            font-size: 0.8125rem;
        }
        
        /* ============ POSTS & ITEMS ============ */
        .filters-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-3);
        }
        
        .filter-group label {
            display: block;
            font-size: 0.8125rem;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
            font-weight: 500;
        }
        
        .post-item, .category-item, .client-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-left: 3px solid var(--primary);
            border-radius: var(--radius);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            transition: all 0.2s;
        }
        
        .post-item:hover, .category-item:hover, .client-item:hover {
            border-left-width: 4px;
            box-shadow: var(--shadow-md);
            transform: translateX(2px);
        }
        
        .post-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: var(--radius);
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .post-content {
            flex: 1;
            min-width: 0;
        }
        
        .post-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }
        
        .post-meta {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .post-actions {
            display: flex;
            gap: var(--space-2);
            flex-shrink: 0;
        }
        
        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius);
            border: 1px solid var(--gray-300);
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .icon-btn:hover {
            background: var(--gray-100);
        }
        
        .badge {
            display: inline-flex;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-paid { background: #d1fae5; color: #065f46; }
        .badge-overdue { background: #fee2e2; color: #991b1b; }
        
        /* ============ MODAL ============ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--space-4);
        }
        
        .modal-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .modal-header h2 {
            font-size: 1.25rem;
            color: var(--gray-900);
            margin: 0;
        }
        
        .modal-body {
            padding: var(--space-4);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-2);
            padding: var(--space-4);
            border-top: 1px solid var(--gray-200);
        }
        
        /* ============ EDITOR ============ */
        #editor-container {
            height: 300px;
            background: var(--white);
        }
        
        .ql-container {
            font-family: 'Poppins', sans-serif;
        }
        
        /* ============ CLIENT PORTAL ============ */
        .client-tabs {
            display: flex;
            gap: var(--space-1);
            margin-bottom: var(--space-4);
            border-bottom: 2px solid var(--gray-200);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: var(--space-2) var(--space-4);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--gray-600);
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: -2px;
        }
        
        .tab-btn:hover {
            color: var(--primary);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .client-tab-content {
            display: none;
        }
        
        .client-tab-content.active {
            display: block;
        }
        
        /* Chat/Messages */
        .chat-container {
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            height: 500px;
            display: flex;
            flex-direction: column;
            background: var(--white);
        }
        
        .chat-header {
            padding: var(--space-3);
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .chat-messages {
            flex: 1;
            padding: var(--space-4);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            background: var(--gray-50);
        }
        
        .message-item {
            display: flex;
            gap: var(--space-2);
            align-items: flex-start;
        }
        
        .message-item.admin {
            flex-direction: row-reverse;
        }
        
        .client-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius);
            word-wrap: break-word;
        }
        
        .message-item.admin .message-bubble {
            background: var(--primary);
            color: var(--white);
            border-bottom-right-radius: 4px;
        }
        
        .message-item.client .message-bubble {
            background: var(--white);
            color: var(--gray-900);
            border: 1px solid var(--gray-200);
            border-bottom-left-radius: 4px;
        }
        
        .message-time {
            font-size: 0.7rem;
            margin-top: var(--space-1);
            opacity: 0.8;
        }
        
        .message-item.admin .message-time {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .message-item.client .message-time {
            color: var(--gray-500);
        }
        
        .chat-input-container {
            padding: var(--space-3);
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: var(--space-2);
            background: var(--white);
        }
        
        /* Spinner for content loading */
        .spinner {
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: var(--space-6) auto;
        }
        
        /* ============ MOBILE ============ */
        @media (max-width: 768px) {
            .admin-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                padding: var(--space-4) var(--space-3);
            }
            
            .stats-grid,
            .actions-grid,
            .filters-card {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Additional styles for client management */
        .text-danger {
            color: var(--danger);
        }
        
        .text-success {
            color: var(--success);
        }
        
        .text-muted {
            color: var(--gray-500);
        }
        
        /* Invoice Cards */
        .invoice-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            transition: all 0.2s;
        }
        
        .invoice-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
            gap: var(--space-3);
            flex-wrap: wrap;
        }
        
        .invoice-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            background: linear-gradient(135deg, var(--info) 0%, #0891b2 100%);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .invoice-info {
            flex: 1;
        }
        
        .invoice-number {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }
        
        .invoice-meta {
            font-size: 0.8125rem;
            color: var(--gray-600);
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }
        
        .invoice-amount {
            text-align: right;
        }
        
        .invoice-amount-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }
        
        .invoice-status-badge {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .invoice-status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .invoice-status-paid {
            background: #d1fae5;
            color: #065f46;
        }
        
        .invoice-status-overdue {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .invoice-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }
        
        .btn-inline {
            padding: var(--space-2) var(--space-3);
            font-size: 0.875rem;
        }
        
        /* Milestone Cards */
        .milestone-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-left: 4px solid var(--info);
            border-radius: var(--radius);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
        }
        
        .milestone-card h4 {
            font-size: 1rem;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        
        /* File Items */
        .file-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            transition: all 0.2s;
        }
        
        .file-item:hover {
            background: var(--gray-50);
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            background: var(--primary-lightest);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            background: var(--gray-900);
            color: var(--white);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1100;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        
        @keyframes slideIn {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>

<!-- LOADING VIEW -->
    <div id="loading-view">
    <div class="spinner"></div>
    </div>

<!-- LOGIN VIEW -->
<div id="login-view" class="hidden">
    <div class="login-card">
        <h1>ðŸš€ Epplicon CMS</h1>
        <form id="login-form">
                <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" class="form-control" required>
                </div>
            <button type="submit" class="btn btn-block">
                <i class="fas fa-sign-in-alt"></i> Login
                </button>
            <div id="login-error" class="alert alert-error hidden"></div>
            </form>
        </div>
    </div>

<!-- ADMIN VIEW -->
<div id="admin-view" class="admin-layout hidden">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>Epplicon CMS</h1>
        </div>
        
        <nav class="nav-menu">
            <a href="#" class="nav-link active" data-view="dashboard">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="#" class="nav-link" data-view="posts">
                <i class="fas fa-file-alt"></i> Posts
            </a>
            <a href="#" class="nav-link" data-view="categories">
                <i class="fas fa-tags"></i> Categories
            </a>
            <a href="#" class="nav-link" data-view="clients">
                <i class="fas fa-users"></i> Client Portal
            </a>
            <a href="#" class="nav-link" data-view="profile">
                <i class="fas fa-user-circle"></i> My Profile
            </a>
        </nav>

        <button id="logout-btn" class="btn btn-secondary btn-block">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        
        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome back! Here's an overview of your content.</p>
                </div>
                <button class="btn" id="refresh-dashboard">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div class="stats-grid">
                    <div class="stat-card blue">
                    <div class="stat-icon">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="stat-posts">0</div>
                        <div class="stat-label">Total Posts</div>
                        <div class="stat-hint">All posts in your blog</div>
                    </div>
                </div>
                
                    <div class="stat-card green">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="stat-published">0</div>
                        <div class="stat-label">Published</div>
                        <div class="stat-hint">Live on your blog</div>
                    </div>
                </div>
                
                    <div class="stat-card orange">
                    <div class="stat-icon">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="stat-drafts">0</div>
                        <div class="stat-label">Drafts</div>
                        <div class="stat-hint">In progress</div>
                    </div>
                </div>
                
                    <div class="stat-card purple">
                    <div class="stat-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="stat-categories">0</div>
                        <div class="stat-label">Categories</div>
                        <div class="stat-hint">Content topics</div>
                    </div>
                </div>
                
                    <div class="stat-card teal">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="stat-clients">0</div>
                        <div class="stat-label">Total Clients</div>
                        <div class="stat-hint">Active clients</div>
                </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-bolt"></i> Quick Actions
                </h2>
                <div class="actions-grid">
                    <button class="action-btn" id="quick-new-post">
                        <div class="action-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="action-text">
                            <strong>Create New Post</strong>
                            <small>Start writing a new article</small>
                        </div>
                    </button>
                    
                    <button class="action-btn" id="quick-categories">
                        <div class="action-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="action-text">
                            <strong>Manage Categories</strong>
                            <small>Organize your content</small>
                        </div>
                    </button>
                    
                    <button class="action-btn" id="quick-clients">
                        <div class="action-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="action-text">
                            <strong>Manage Clients</strong>
                            <small>View and manage clients</small>
                        </div>
                    </button>
                    
                    <button class="action-btn" id="quick-blog">
                        <div class="action-icon">
                            <i class="fas fa-external-link-alt"></i>
                        </div>
                        <div class="action-text">
                            <strong>View Blog</strong>
                            <small>See your live website</small>
                        </div>
                    </button>
                </div>
                </div>
            </div>

        <!-- POSTS VIEW -->
        <div id="view-posts" class="view-content hidden">
            <div class="page-header">
                <div>
                    <h1 class="page-title">All Posts</h1>
                    <p class="page-subtitle">Manage and organize your blog posts</p>
                </div>
                <button class="btn" id="new-post-btn">
                        <i class="fas fa-plus"></i> Create New Post
                    </button>
                </div>
                
            <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-filter"></i> Filters & Search
                </h2>
                <div class="filters-card">
                    <div class="filter-group">
                        <label><i class="fas fa-search"></i> Search Posts</label>
                        <input type="text" id="post-search" class="form-control" placeholder="Search by title...">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-flag"></i> Status</label>
                    <select id="status-filter" class="form-control">
                        <option value="">All Status</option>
                        <option value="published">Published</option>
                        <option value="draft">Draft</option>
                    </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-tag"></i> Category</label>
                    <select id="category-filter" class="form-control">
                        <option value="">All Categories</option>
                    </select>
                </div>
                    <div class="filter-group">
                        <button class="btn btn-secondary btn-block" id="clear-filters" style="margin-top: 24px;">
                            <i class="fas fa-times"></i> Clear
                    </button>
                </div>
                </div>
            </div>

            <div id="posts-list">
                <div class="spinner"></div>
                        </div>
                        </div>

        <!-- CATEGORIES VIEW -->
        <div id="view-categories" class="view-content hidden">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Manage Categories</h1>
                    <p class="page-subtitle">Organize your content with categories</p>
                        </div>
                        </div>

            <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-plus-circle"></i> Add New Category
                </h2>
                <form id="category-form" style="display: grid; grid-template-columns: 1fr auto auto; gap: var(--space-3); align-items: end;">
                    <div class="form-group" style="margin: 0;">
                        <label>Category Name</label>
                        <input type="text" id="category-name" class="form-control" placeholder="e.g., Technology, Design..." required>
                    </div>
                    <input type="hidden" id="category-id">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button type="button" class="btn btn-secondary hidden" id="cancel-category">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </form>
                        </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                    <h2 class="section-title" style="margin: 0;">
                        <i class="fas fa-list"></i> All Categories
                    </h2>
                    <span id="category-count" style="color: var(--gray-500); font-weight: 600;">0 categories</span>
                            </div>
                <div id="categories-list">
                    <div class="spinner"></div>
                        </div>
                            </div>
                        </div>

        <!-- CLIENTS VIEW -->
        <div id="view-clients" class="view-content hidden">
            <div class="page-header">
                            <div>
                    <h1 class="page-title">Client Portal Management</h1>
                    <p class="page-subtitle">Manage client accounts, projects, and communications</p>
                            </div>
                <button class="btn" id="refresh-clients-btn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                        </div>
            
            <!-- Client List Card -->
            <div class="card" id="clients-list-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                    <h2 class="section-title" style="margin: 0;">
                        <i class="fas fa-users"></i> All Clients
                    </h2>
                    <span id="clients-count" style="color: var(--gray-500); font-weight: 600;">0 clients</span>
                </div>
                <div id="clients-list">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Client Management View (populated by admin-client-portal.js) -->
            <div id="client-management-view" class="hidden" style="width: 100%; max-width: 100%;">
                <div class="card" style="background: var(--white); border: 2px solid var(--primary); box-shadow: var(--shadow-lg);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-4); padding-bottom: var(--space-4); border-bottom: 2px solid var(--primary); flex-wrap: wrap; gap: var(--space-4);">
                        <div style="flex: 1;">
                            <h2 id="selected-client-name" style="margin: 0 0 var(--space-3) 0; color: var(--primary); font-size: 1.5rem;">
                                <i class="fas fa-user-circle"></i> Client Name
                            </h2>
                            
                            <!-- Client Info Grid -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-3); background: var(--gray-50); padding: var(--space-4); border-radius: var(--radius-lg);">
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: var(--space-1); text-transform: uppercase; font-weight: 600;">Email</div>
                                    <div id="selected-client-email" style="color: var(--text-primary); font-weight: 500;">
                                        <i class="fas fa-envelope" style="color: var(--primary); margin-right: var(--space-1);"></i>
                                        client@email.com
                </div>
            </div>
            
                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: var(--space-1); text-transform: uppercase; font-weight: 600;">WhatsApp</div>
                                    <div id="selected-client-whatsapp" style="color: var(--text-primary); font-weight: 500;">
                                        <i class="fab fa-whatsapp" style="color: #25D366; margin-right: var(--space-1);"></i>
                                        <span>Not provided</span>
                                    </div>
                </div>

                                <div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: var(--space-1); text-transform: uppercase; font-weight: 600;">Country Code</div>
                                    <div id="selected-client-country" style="color: var(--text-primary); font-weight: 500;">
                                        <i class="fas fa-globe" style="color: var(--info); margin-right: var(--space-1);"></i>
                                        <span>Not provided</span>
                    </div>
                </div>

                            <div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: var(--space-1); text-transform: uppercase; font-weight: 600;">Joined</div>
                                    <div id="selected-client-joined" style="color: var(--text-primary); font-weight: 500;">
                                        <i class="fas fa-calendar" style="color: var(--success); margin-right: var(--space-1);"></i>
                                        <span>-</span>
                            </div>
                                </div>
                            </div>
                        </div>
                        <button id="close-client-view" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>

                        <!-- Client Management Tabs -->
                    <div class="client-tabs" style="border-bottom: 2px solid var(--gray-200); margin-bottom: var(--space-4);">
                        <button class="tab-btn client-tab-btn active" data-tab="client-projects">
                                <i class="fas fa-project-diagram"></i> Projects
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-messages">
                                <i class="fas fa-comments"></i> Messages
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-files">
                                <i class="fas fa-folder"></i> Files
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-milestones">
                                <i class="fas fa-timeline"></i> Milestones
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-invoices">
                                <i class="fas fa-file-invoice"></i> Invoices
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-features">
                                <i class="fas fa-lightbulb"></i> Feature Requests
                            </button>
                        <button class="tab-btn client-tab-btn" data-tab="client-profile">
                            <i class="fas fa-user-cog"></i> Profile & History
                        </button>
                        </div>

                        <!-- Projects Tab -->
                    <div id="client-tab-projects" class="tab-content client-tab-content active">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                            <h3 style="margin: 0;">
                                    <i class="fas fa-project-diagram"></i> Projects
                                </h3>
                            <button id="create-project-btn" class="btn">
                                    <i class="fas fa-plus"></i> Create Project
                                </button>
                            </div>
                        <div id="client-projects-list"></div>
                        </div>

                        <!-- Messages Tab -->
                    <div id="client-tab-messages" class="tab-content client-tab-content">
                        <h3 style="margin-bottom: var(--space-3);">
                                    <i class="fas fa-comments"></i> Chat with Client
                                </h3>
                        <div class="chat-container">
                            <div class="chat-header">
                                <strong>Messages</strong>
                            </div>
                            <div class="chat-messages" id="admin-chat-messages"></div>
                            <div class="chat-input-container">
                                <input type="text" id="admin-chat-input" class="form-control" placeholder="Type a message..." style="flex: 1;">
                                <button class="btn" id="admin-send-message-btn">
                                        <i class="fas fa-paper-plane"></i> Send
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Files Tab -->
                    <div id="client-tab-files" class="tab-content client-tab-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                            <h3 style="margin: 0;">
                                    <i class="fas fa-folder"></i> Files
                                </h3>
                            <button class="btn" id="admin-upload-file-btn">
                                        <i class="fas fa-upload"></i> Upload File
                                    </button>
                            <input type="file" id="admin-upload-file" style="display: none;">
                                </div>
                        <div id="client-files-list"></div>
                        </div>

                        <!-- Milestones Tab -->
                    <div id="client-tab-milestones" class="tab-content client-tab-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                            <h3 style="margin: 0;">
                                    <i class="fas fa-timeline"></i> Milestones
                                </h3>
                            <button id="create-milestone-btn" class="btn">
                                    <i class="fas fa-plus"></i> Add Milestone
                                </button>
                            </div>
                        <div id="client-milestones-list"></div>
                        </div>

                        <!-- Invoices Tab -->
                    <div id="client-tab-invoices" class="tab-content client-tab-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                            <h3 style="margin: 0;">
                                    <i class="fas fa-file-invoice"></i> Invoices
                                </h3>
                            <button id="create-invoice-btn" class="btn">
                                    <i class="fas fa-plus"></i> Create Invoice
                                </button>
                            </div>
                        
                        <!-- Invoice Filters -->
                        <div style="display: flex; gap: var(--space-3); margin-bottom: var(--space-4); flex-wrap: wrap;">
                            <select id="invoice-status-filter" class="form-control" style="width: auto; min-width: 150px;">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="paid">Paid</option>
                                <option value="overdue">Overdue</option>
                            </select>
                            <input type="text" id="invoice-search" class="form-control" placeholder="Search invoices..." style="flex: 1; min-width: 200px;">
                        </div>
                        
                        <div id="client-invoices-list"></div>
                        </div>

                        <!-- Feature Requests Tab -->
                    <div id="client-tab-features" class="tab-content client-tab-content">
                        <h3 style="margin-bottom: var(--space-3);">
                                    <i class="fas fa-lightbulb"></i> Feature Requests
                                </h3>
                        <div id="client-feature-requests-list"></div>
                            </div>
                    
                    <!-- Profile & Edit History Tab -->
                    <div id="client-tab-profile" class="tab-content client-tab-content">
                        <h3 style="margin-bottom: var(--space-3);">
                            <i class="fas fa-user-cog"></i> Client Profile & Edit History
                        </h3>
                        <div id="client-profile-info"></div>
                        
                        <h3 style="margin: var(--space-6) 0 var(--space-3) 0;">
                            <i class="fas fa-history"></i> Edit History
                        </h3>
                        <div id="client-edit-history"></div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- PROFILE VIEW -->
        <div id="view-profile" class="view-content hidden">
            <div class="page-header">
                <div>
                    <h1 class="page-title">My Profile</h1>
                    <p class="page-subtitle">Manage your author profile information</p>
                </div>
            </div>
            
                <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-user-circle"></i> Author Profile Settings
                </h2>
                    <form id="profile-form">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: var(--space-5); align-items: start; margin-bottom: var(--space-5);">
                        <div style="text-align: center;">
                            <div id="profile-image-preview" style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--primary-light)); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 3rem; margin-bottom: var(--space-3); overflow: hidden;">
                                <i class="fas fa-user"></i>
                            </div>
                            <label for="profile-image" class="btn btn-secondary" style="cursor: pointer;">
                                <i class="fas fa-camera"></i> Change Photo
                            </label>
                            <input type="file" id="profile-image" accept="image/*" style="display: none;">
                            <small style="display: block; color: var(--gray-500); margin-top: var(--space-2); font-size: 0.75rem;">Recommended: 400x400px</small>
                        </div>
                        
                        <div>
                        <div class="form-group">
                                <label>Display Name *</label>
                                <input type="text" id="profile-name" class="form-control" placeholder="Your name as it appears on posts" required>
                        </div>

                        <div class="form-group">
                                <label>Bio / Description</label>
                                <textarea id="profile-bio" class="form-control" rows="4" placeholder="Write a short bio about yourself..." maxlength="500"></textarea>
                                <div style="text-align: right; margin-top: var(--space-1);">
                                    <small id="bio-count" style="color: var(--gray-500);">0/500 characters</small>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                    <div style="display: flex; justify-content: flex-end; gap: var(--space-2); padding-top: var(--space-4); border-top: 1px solid var(--gray-200);">
                        <span id="profile-status" style="flex: 1; color: var(--primary); font-weight: 500;"></span>
                        <button type="button" class="btn btn-secondary" id="cancel-profile">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i> Save Profile
                        </button>
                        </div>
                    </form>
                </div>
            </div>

        </main>
    </div>
    
<!-- HTML PASTE MODAL -->
<div id="html-paste-modal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Paste HTML Code</h2>
            <button class="icon-btn" onclick="closeHtmlPasteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Paste your HTML code below:</label>
                <textarea id="html-paste-input" class="form-control" rows="10" placeholder="<h2>My Title</h2><p>My content...</p>" style="font-family: 'Courier New', monospace;"></textarea>
                <small style="color: var(--gray-500); display: block; margin-top: var(--space-2);">
                    <i class="fas fa-info-circle"></i> This will insert HTML at the current cursor position in the editor.
                </small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeHtmlPasteModal()">Cancel</button>
            <button class="btn" onclick="insertHtmlToEditor()">
                <i class="fas fa-code"></i> Insert HTML
            </button>
            </div>
        </div>
    </div>

<!-- INVOICE MODAL -->
<div id="invoice-modal" class="modal-overlay hidden" onclick="if(event.target === this) window.closeInvoiceModal && window.closeInvoiceModal();">
    <div class="modal-content" style="max-width: 600px;" onclick="event.stopPropagation();">
        <div class="modal-header">
            <h2 id="invoice-modal-title">Create Invoice</h2>
            <button type="button" class="icon-btn" id="invoice-modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="invoice-form">
            <div class="modal-body">
                <input type="hidden" id="invoice-edit-id">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-3);">
                    <div class="form-group">
                        <label>Invoice Number *</label>
                        <input type="text" id="invoice-number" class="form-control" required placeholder="INV-001">
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="invoice-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Project Name *</label>
                        <input type="text" id="invoice-project" class="form-control" required placeholder="Project Name">
                    </div>
                    <div class="form-group">
                        <label>Amount ($) *</label>
                        <input type="number" id="invoice-amount" class="form-control" required step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Status *</label>
                        <select id="invoice-status" class="form-control" required>
                            <option value="pending">Pending</option>
                            <option value="paid">Paid</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Notes (Optional)</label>
                        <textarea id="invoice-notes" class="form-control" rows="3" placeholder="Additional notes..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="invoice-modal-cancel">Cancel</button>
                <button type="submit" class="btn" id="invoice-modal-save">
                    <i class="fas fa-save"></i> Save Invoice
                </button>
            </div>
        </form>
    </div>
</div>

<!-- POST EDITOR MODAL -->
<div id="post-editor-modal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 id="editor-modal-title">Create New Post</h2>
            <button class="icon-btn" onclick="closePostEditor()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="post-form">
                <input type="hidden" id="post-id">
                
                <div class="form-group">
                    <label>Post Title *</label>
                    <input type="text" id="post-title" class="form-control" required placeholder="Enter a compelling title">
                </div>
                
                <div class="form-group">
                    <label>Post Slug (URL)</label>
                    <input type="text" id="post-slug" class="form-control" readonly placeholder="Auto-generated from title">
                    <small style="color: var(--gray-500); font-size: 0.8125rem;">This is generated automatically and cannot be changed.</small>
                </div>
                
                <div class="form-group">
                    <label>Categories * <small>(Hold Ctrl/Cmd for multiple)</small></label>
                    <select id="post-categories" class="form-control" multiple required style="height: 100px;">
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Short Excerpt</label>
                    <textarea id="post-excerpt" class="form-control" rows="2" maxlength="200" placeholder="Brief summary for blog list page"></textarea>
                    <div style="text-align: right; margin-top: var(--space-1);">
                        <small id="excerpt-count" style="color: var(--gray-500);">0/200 characters</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Status</label>
                    <select id="post-status" class="form-control">
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Feature Image</label>
                    <input type="file" id="post-image" class="form-control" accept="image/*">
                    <div id="post-image-preview" class="hidden" style="margin-top: var(--space-2);">
                        <img src="" style="max-width: 200px; border-radius: var(--radius);">
                    </div>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2);">
                        <label style="margin: 0;">Main Content *</label>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="openHtmlPasteModal()">
                            <i class="fas fa-code"></i> Paste HTML
                        </button>
                    </div>
                    <div id="editor-container"></div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closePostEditor()">Cancel</button>
            <button class="btn" onclick="savePost()">
                <i class="fas fa-save"></i> Save Post
            </button>
        </div>
    </div>
</div>

<!-- Firebase & Quill -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!-- Invoice PDF Generator -->
<script src="assets/js/invoice-pdf-generator.js"></script>
<script type="module">
    // Import and initialize admin client portal
    import { initAdminClientPortal } from './assets/js/admin-client-portal.js';
    
    // Expose to window so it can be called from main script
    window.initAdminClientPortal = initAdminClientPortal;
</script>
<script type="module">
    // Import Firebase (using same version as admin-client-portal.js for compatibility)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
    import { getFirestore, collection, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, addDoc, query, orderBy, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js';
    
    // Import config
    import { firebaseConfig_DB_AUTH, firebaseConfig_STORAGE } from './config.js';
    
    // Initialize Firebase
    const app1 = initializeApp(firebaseConfig_DB_AUTH, 'main');
    const app2 = initializeApp(firebaseConfig_STORAGE, 'storage');
    const auth = getAuth(app1);
    const db = getFirestore(app1);
    const storage = getStorage(app2);
    
    // Define showToast early
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i> ${message}`;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
    
    // Expose Firebase to window for client portal script
    window.adminDB = db;
    window.adminStorage = storage;
    window.adminAuth = auth;
    window.currentAdminUser = null;
    window.showToast = showToast;
    window.db = db;
    window.storage = storage;
    
    // Expose Firestore functions for invoice PDF generator
    window.getDoc = getDoc;
    window.doc = doc;
    window.collection = collection;
    window.query = query;
    window.where = where;
    window.getDocs = getDocs;
    
    // State
    let currentUser = null;
    let currentView = 'dashboard';
    let quill = null;
    let editingPostId = null;
    let editingCategoryId = null;
    
    // DOM Elements
    const loadingView = document.getElementById('loading-view');
    const loginView = document.getElementById('login-view');
    const adminView = document.getElementById('admin-view');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const logoutBtn = document.getElementById('logout-btn');
    
    // Initialize Quill
    function initQuill() {
        if (!quill) {
            quill = new Quill('#editor-container', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        ['blockquote', 'code-block'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'color': [] }, { 'background': [] }],
                        ['link', 'image'],
                        ['clean']
                    ]
                },
                placeholder: 'Write your post content here...'
            });
        }
    }
    
    // Navigation
    const navLinks = document.querySelectorAll('.nav-link');
    const viewContents = document.querySelectorAll('.view-content');
    
    // Auth State
            onAuthStateChanged(auth, async (user) => {
                if (user) {
            const authorDoc = await getDoc(doc(db, 'authors', user.uid));
            if (authorDoc.exists()) {
                currentUser = user;
                window.currentAdminUser = user;
                            loadingView.classList.add('hidden');
                loginView.classList.add('hidden');
                            adminView.classList.remove('hidden');
                loadDashboardStats();
                loadProfile();
                initQuill();
                        } else {
                                await signOut(auth);
                showError('Access denied. Admin only.');
            }
                            } else {
            currentUser = null;
                                loadingView.classList.add('hidden');
                        loginView.classList.remove('hidden');
                        adminView.classList.add('hidden');
        }
    });
    
    // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

            try {
            await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
            showError(error.message);
        }
    });
    
    // Logout
    logoutBtn.addEventListener('click', () => signOut(auth));
    
    // Navigation
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const view = link.dataset.view;
            switchView(view);
        });
    });
    
    function switchView(view) {
        navLinks.forEach(l => l.classList.remove('active'));
        viewContents.forEach(v => v.classList.add('hidden'));
        
        document.querySelector(`[data-view="${view}"]`)?.classList.add('active');
        document.getElementById(`view-${view}`)?.classList.remove('hidden');
        
        currentView = view;
        
        if (view === 'dashboard') loadDashboardStats();
        if (view === 'posts') loadPosts();
        if (view === 'categories') loadCategories();
        if (view === 'clients') {
            // Small delay to ensure the module is loaded
            setTimeout(() => {
                // Initialize the full client portal management system
                if (window.initAdminClientPortal) {
                    console.log('Initializing full admin client portal...');
                    window.initAdminClientPortal(db, storage);
                } else {
                    console.warn('Full admin client portal not loaded, using fallback');
                    // Fallback to basic client list
                    loadClients();
                }
            }, 100);
            }
        }
        
    // Dashboard Stats
        async function loadDashboardStats() {
            try {
            const postsSnap = await getDocs(collection(db, 'posts'));
            const published = postsSnap.docs.filter(d => d.data().isPublished).length;
            
            document.getElementById('stat-posts').textContent = postsSnap.size;
            document.getElementById('stat-published').textContent = published;
            document.getElementById('stat-drafts').textContent = postsSnap.size - published;
            
            const categoriesSnap = await getDocs(collection(db, 'categories'));
            document.getElementById('stat-categories').textContent = categoriesSnap.size;
            
            const clientsSnap = await getDocs(collection(db, 'clients'));
            document.getElementById('stat-clients').textContent = clientsSnap.size;
            } catch (error) {
            console.error('Error loading stats:', error);
        }
    }
    
    // Quick Actions
    document.getElementById('quick-new-post').addEventListener('click', () => openPostEditor());
    document.getElementById('quick-categories').addEventListener('click', () => switchView('categories'));
    document.getElementById('quick-clients').addEventListener('click', () => switchView('clients'));
    document.getElementById('quick-blog').addEventListener('click', () => window.open('/', '_blank'));
    document.getElementById('refresh-dashboard').addEventListener('click', loadDashboardStats);
    document.getElementById('new-post-btn').addEventListener('click', () => openPostEditor());
    
    // Posts
    async function loadPosts() {
        const postsList = document.getElementById('posts-list');
        const categoryFilter = document.getElementById('category-filter');
        
        postsList.innerHTML = '<div class="spinner"></div>';
        
        // Load categories for filter
        const categoriesSnap = await getDocs(query(collection(db, 'categories'), orderBy('name')));
        categoryFilter.innerHTML = '<option value="">All Categories</option>';
        categoriesSnap.forEach(doc => {
            const opt = document.createElement('option');
            opt.value = doc.id;
            opt.textContent = doc.data().name;
            categoryFilter.appendChild(opt);
        });
        
        try {
            const q = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                postsList.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: var(--space-6);">No posts yet. Create your first post!</p>';
                return;
            }
            
            postsList.innerHTML = '';
            snapshot.forEach(docSnap => {
                const post = docSnap.data();
                const item = document.createElement('div');
                item.className = 'post-item';
                item.dataset.status = post.isPublished ? 'published' : 'draft';
                item.dataset.title = post.title.toLowerCase();
                
                item.innerHTML = `
                    ${post.featuredImage ? `<img src="${post.featuredImage}" class="post-thumbnail">` : `<div class="post-thumbnail" style="background: var(--gray-200); display: flex; align-items: center; justify-content: center;"><i class="fas fa-image" style="color: var(--gray-400);"></i></div>`}
                    <div class="post-content">
                        <div class="post-title">${post.title}</div>
                        <div class="post-meta">${post.authorName || 'Unknown'} â€¢ ${post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleDateString() : 'N/A'}</div>
                    </div>
                    <span class="badge ${post.isPublished ? 'badge-success' : 'badge-warning'}">${post.isPublished ? 'Published' : 'Draft'}</span>
                    <div class="post-actions">
                        <button class="icon-btn" onclick="editPost('${docSnap.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="icon-btn" onclick="deletePost('${docSnap.id}')" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                postsList.appendChild(item);
            });
            
            setupPostFilters();
        } catch (error) {
            console.error('Error loading posts:', error);
            postsList.innerHTML = '<p style="color: var(--danger); text-align: center;">Error loading posts</p>';
        }
    }
    
    function setupPostFilters() {
        const searchInput = document.getElementById('post-search');
        const statusFilter = document.getElementById('status-filter');
        const categoryFilter = document.getElementById('category-filter');
        const clearBtn = document.getElementById('clear-filters');
        
        function filterPosts() {
            const search = searchInput.value.toLowerCase();
            const status = statusFilter.value;
            
            document.querySelectorAll('.post-item').forEach(item => {
                const matchesSearch = item.dataset.title.includes(search);
                const matchesStatus = !status || item.dataset.status === status;
                
                item.style.display = matchesSearch && matchesStatus ? 'flex' : 'none';
            });
        }
        
        searchInput.addEventListener('input', filterPosts);
        statusFilter.addEventListener('change', filterPosts);
        categoryFilter.addEventListener('change', filterPosts);
        
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            statusFilter.value = '';
            categoryFilter.value = '';
            filterPosts();
        });
    }
    
    // Post Editor
    function openPostEditor(postId = null) {
        editingPostId = postId;
        const modal = document.getElementById('post-editor-modal');
        const title = document.getElementById('editor-modal-title');
        
        if (postId) {
            title.textContent = 'Edit Post';
            loadPostForEdit(postId);
        } else {
            title.textContent = 'Create New Post';
            document.getElementById('post-form').reset();
            document.getElementById('post-id').value = '';
            document.getElementById('post-slug').value = '(Auto-generated)';
            quill.root.innerHTML = '';
            document.getElementById('post-image-preview').classList.add('hidden');
        }
        
        loadCategoriesForEditor();
        modal.classList.remove('hidden');
    }
    
    function closePostEditor() {
        document.getElementById('post-editor-modal').classList.add('hidden');
        editingPostId = null;
    }
    
    async function loadCategoriesForEditor() {
        const select = document.getElementById('post-categories');
        select.innerHTML = '';
        
        const snapshot = await getDocs(query(collection(db, 'categories'), orderBy('name')));
        snapshot.forEach(doc => {
            const opt = document.createElement('option');
            opt.value = doc.id;
            opt.textContent = doc.data().name;
            select.appendChild(opt);
        });
    }
    
    async function loadPostForEdit(postId) {
        const docSnap = await getDoc(doc(db, 'posts', postId));
        if (docSnap.exists()) {
            const post = docSnap.data();
            document.getElementById('post-id').value = postId;
            document.getElementById('post-title').value = post.title;
            document.getElementById('post-slug').value = post.slug || '';
            document.getElementById('post-excerpt').value = post.excerpt || '';
            document.getElementById('post-status').value = post.isPublished ? 'published' : 'draft';
            quill.root.innerHTML = post.content || '';
            
            if (post.featuredImage) {
                const preview = document.getElementById('post-image-preview');
                preview.querySelector('img').src = post.featuredImage;
                preview.classList.remove('hidden');
            }
            
            if (post.categoryIds) {
                const select = document.getElementById('post-categories');
                Array.from(select.options).forEach(opt => {
                    opt.selected = post.categoryIds.includes(opt.value);
                });
            }
            
            updateExcerptCount();
        }
    }
    
    async function savePost() {
        const postId = document.getElementById('post-id').value;
        const title = document.getElementById('post-title').value.trim();
        const excerpt = document.getElementById('post-excerpt').value.trim();
        const status = document.getElementById('post-status').value;
        const content = quill.root.innerHTML;
        const imageFile = document.getElementById('post-image').files[0];
        
        if (!title || !content) {
            showToast('Please fill in all required fields', 'error');
            return;
        }
        
        const selectedCategories = Array.from(document.getElementById('post-categories').selectedOptions).map(opt => opt.value);
        if (selectedCategories.length === 0) {
            showToast('Please select at least one category', 'error');
            return;
        }
        
        try {
            showToast('Saving post...', 'info');
            
            let postData = {
                title,
                excerpt,
                content,
                isPublished: status === 'published',
                categoryIds: selectedCategories,
                authorId: currentUser.uid,
                authorName: (await getDoc(doc(db, 'authors', currentUser.uid))).data()?.name || 'Unknown',
                updatedAt: serverTimestamp()
            };
            
            // Upload image if provided
            if (imageFile) {
                const imageRef = storageRef(storage, `posts/${Date.now()}_${imageFile.name}`);
                await uploadBytes(imageRef, imageFile);
                postData.featuredImage = await getDownloadURL(imageRef);
            }
            
            if (postId) {
                await updateDoc(doc(db, 'posts', postId), postData);
                showToast('Post updated successfully!', 'success');
            } else {
                postData.slug = createSlug(title);
                postData.createdAt = serverTimestamp();
                await addDoc(collection(db, 'posts'), postData);
                showToast('Post created successfully!', 'success');
            }
            
            closePostEditor();
            loadPosts();
            loadDashboardStats();
            } catch (error) {
            console.error('Error saving post:', error);
            showToast('Error saving post: ' + error.message, 'error');
        }
    }
    
    function createSlug(title) {
        return title.toLowerCase()
            .trim()
            .replace(/[^\w\s-]/g, '')
            .replace(/[\s_-]+/g, '-')
            .replace(/^-+|-+$/g, '');
    }
    
    async function deletePost(postId) {
        if (!confirm('Delete this post permanently?')) return;
        
        try {
            await deleteDoc(doc(db, 'posts', postId));
            showToast('Post deleted', 'success');
            loadPosts();
            loadDashboardStats();
        } catch (error) {
            showToast('Error deleting post', 'error');
        }
    }
    
    // Excerpt counter
    document.getElementById('post-excerpt')?.addEventListener('input', updateExcerptCount);
    function updateExcerptCount() {
        const textarea = document.getElementById('post-excerpt');
        const counter = document.getElementById('excerpt-count');
        if (textarea && counter) {
            counter.textContent = `${textarea.value.length}/200 characters`;
        }
    }
    
    // Categories
    async function loadCategories() {
        const categoriesList = document.getElementById('categories-list');
        categoriesList.innerHTML = '<div class="spinner"></div>';
        
        try {
            const q = query(collection(db, 'categories'), orderBy('name'));
            const snapshot = await getDocs(q);
            
            document.getElementById('category-count').textContent = `${snapshot.size} categories`;
            
            if (snapshot.empty) {
                categoriesList.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: var(--space-4);">No categories yet.</p>';
                return;
            }
            
            categoriesList.innerHTML = '';
            snapshot.forEach(docSnap => {
                const category = docSnap.data();
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="post-content">
                        <div class="post-title">${category.name}</div>
                        <div class="post-meta">Slug: ${category.slug}</div>
                            </div>
                    <div class="post-actions">
                        <button class="icon-btn" onclick="editCategory('${docSnap.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="icon-btn" onclick="deleteCategory('${docSnap.id}')" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                categoriesList.appendChild(item);
                    });
            } catch (error) {
            console.error('Error loading categories:', error);
            categoriesList.innerHTML = '<p style="color: var(--danger); text-align: center;">Error loading categories</p>';
            }
        }
        
    document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
        const name = document.getElementById('category-name').value.trim();
        const id = document.getElementById('category-id').value;
        
        if (!name) return;
        
        try {
            const categoryData = {
                name,
                slug: createSlug(name),
                updatedAt: serverTimestamp()
            };
            
            if (id) {
                await updateDoc(doc(db, 'categories', id), categoryData);
                showToast('Category updated', 'success');
                } else {
                categoryData.createdAt = serverTimestamp();
                await addDoc(collection(db, 'categories'), categoryData);
                showToast('Category created', 'success');
            }
            
            document.getElementById('category-form').reset();
            document.getElementById('category-id').value = '';
            document.getElementById('cancel-category').classList.add('hidden');
            loadCategories();
            loadDashboardStats();
            } catch (error) {
            showToast('Error saving category', 'error');
        }
    });
    
    document.getElementById('cancel-category').addEventListener('click', () => {
        document.getElementById('category-form').reset();
        document.getElementById('category-id').value = '';
        document.getElementById('cancel-category').classList.add('hidden');
    });
    
    window.editCategory = async (id) => {
        const docSnap = await getDoc(doc(db, 'categories', id));
        if (docSnap.exists()) {
            const category = docSnap.data();
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-id').value = id;
            document.getElementById('cancel-category').classList.remove('hidden');
        }
    };
    
    window.deleteCategory = async (id) => {
        if (!confirm('Delete this category?')) return;
        
        try {
            await deleteDoc(doc(db, 'categories', id));
            showToast('Category deleted', 'success');
            loadCategories();
            loadDashboardStats();
                    } catch (error) {
            showToast('Error deleting category', 'error');
        }
    };
    
    // Profile
    async function loadProfile() {
        if (!currentUser) return;
        
        const profileDoc = await getDoc(doc(db, 'authors', currentUser.uid));
        if (profileDoc.exists()) {
            const profile = profileDoc.data();
            document.getElementById('profile-name').value = profile.name || '';
            document.getElementById('profile-bio').value = profile.description || '';
            updateBioCount();
            
            if (profile.image) {
                document.getElementById('profile-image-preview').innerHTML = `<img src="${profile.image}" style="width: 100%; height: 100%; object-fit: cover;">`;
            }
        }
    }
    
    const profileBio = document.getElementById('profile-bio');
    const bioCount = document.getElementById('bio-count');
    
    function updateBioCount() {
        const length = profileBio.value.length;
        bioCount.textContent = `${length}/500 characters`;
        bioCount.style.color = length > 450 ? 'var(--danger)' : 'var(--gray-500)';
    }
    
    profileBio.addEventListener('input', updateBioCount);
    
    document.getElementById('profile-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const status = document.getElementById('profile-status');
        status.textContent = 'Saving...';
        
        try {
            const profileData = {
                name: document.getElementById('profile-name').value,
                description: document.getElementById('profile-bio').value,
                updatedAt: serverTimestamp()
            };
            
            const imageFile = document.getElementById('profile-image').files[0];
            if (imageFile) {
                const imageRef = storageRef(storage, `authors/${currentUser.uid}/${Date.now()}_${imageFile.name}`);
                await uploadBytes(imageRef, imageFile);
                profileData.image = await getDownloadURL(imageRef);
            }
            
            await setDoc(doc(db, 'authors', currentUser.uid), profileData, { merge: true });
            status.textContent = 'Profile saved successfully!';
            status.style.color = 'var(--success)';
            
            showToast('Profile saved successfully!', 'success');
            
            setTimeout(() => {
                status.textContent = '';
                loadProfile();
            }, 2000);
            } catch (error) {
            console.error('Error saving profile:', error);
            status.textContent = 'Error saving profile';
            status.style.color = 'var(--danger)';
            showToast('Error saving profile', 'error');
        }
    });
    
    document.getElementById('profile-image').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('profile-image-preview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;">`;
            };
            reader.readAsDataURL(file);
        }
    });
    
    document.getElementById('cancel-profile').addEventListener('click', loadProfile);
    
    // Helper Functions
    function showError(message) {
        loginError.textContent = message;
        loginError.classList.remove('hidden');
        setTimeout(() => loginError.classList.add('hidden'), 5000);
    }
    
    // HTML Paste Modal Functions
    window.openHtmlPasteModal = function() {
        document.getElementById('html-paste-modal').classList.remove('hidden');
    };
    
    window.closeHtmlPasteModal = function() {
        document.getElementById('html-paste-modal').classList.add('hidden');
        document.getElementById('html-paste-input').value = '';
    };
    
    window.insertHtmlToEditor = function() {
        const html = document.getElementById('html-paste-input').value;
        if (html && quill) {
            const range = quill.getSelection(true);
            quill.clipboard.dangerouslyPasteHTML(range ? range.index : 0, html);
            showToast('HTML inserted successfully!', 'success');
            closeHtmlPasteModal();
        }
    };
    
    // Clients Management (Fallback - Basic version if full system doesn't load)
    // This will only be used if the full admin-client-portal.js script fails to load
    async function loadClients() {
        console.log('Loading clients (fallback method)...');
        const clientsList = document.getElementById('clients-list');
        
        if (!clientsList) {
            console.error('clients-list element not found');
            return;
        }
        
        clientsList.innerHTML = '<div class="spinner"></div>';
        
        try {
            const snapshot = await getDocs(collection(db, 'clients'));
            
            // Update count
            const countElement = document.getElementById('clients-count');
            if (countElement) {
                countElement.textContent = `${snapshot.size} clients`;
            }
            
            if (snapshot.empty) {
                clientsList.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: var(--space-4);">No clients yet. Clients will appear here once they register.</p>';
                return;
            }
            
            clientsList.innerHTML = '';
            snapshot.forEach(docSnap => {
                const client = docSnap.data();
                const item = document.createElement('div');
                item.className = 'client-item';
                item.innerHTML = `
                    <div class="stat-icon" style="background: var(--primary); opacity: 1;">
                        <i class="fas fa-user" style="color: var(--white); opacity: 1;"></i>
                                </div>
                    <div class="post-content">
                        <div class="post-title">${client.name || 'Unnamed Client'}</div>
                        <div class="post-meta">${client.email || 'No email'}</div>
                            </div>
                    <button class="btn btn-sm" onclick="alert('Full client management system loading... Please refresh the page if this persists.')">
                        <i class="fas fa-arrow-right"></i> Manage
                    </button>
                `;
                clientsList.appendChild(item);
            });
            } catch (error) {
            console.error('Error loading clients:', error);
            clientsList.innerHTML = `
                <div style="text-align: center; color: var(--danger); padding: var(--space-4);">
                    <p><i class="fas fa-exclamation-triangle"></i> Error loading clients</p>
                    <p style="font-size: 0.875rem;">${error.message}</p>
                </div>
            `;
        }
    }
    
    window.viewClientDetail = async function(clientId) {
        const clientsListCard = document.getElementById('clients-list-card');
        const clientDetail = document.getElementById('client-detail');
        
        clientsListCard.classList.add('hidden');
        clientDetail.classList.remove('hidden');
        
        // Load client data
        const clientDoc = await getDoc(doc(db, 'clients', clientId));
        if (!clientDoc.exists()) {
            showToast('Client not found', 'error');
            return;
        }
        
        const client = clientDoc.data();
        
        clientDetail.innerHTML = `
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4); padding-bottom: var(--space-3); border-bottom: 2px solid var(--primary);">
                    <div>
                        <h2 style="margin: 0 0 var(--space-2) 0; color: var(--primary); font-size: 1.5rem;">
                            <i class="fas fa-user-circle"></i> ${client.name || 'Unnamed Client'}
                        </h2>
                        <p style="color: var(--gray-600); margin: 0;">
                            <i class="fas fa-envelope"></i> ${client.email || 'No email'}
                        </p>
                    </div>
                    <button class="btn btn-secondary" onclick="backToClientsList()">
                        <i class="fas fa-arrow-left"></i> Back to Clients
                    </button>
                </div>
                
                <div class="client-tabs">
                    <button class="tab-btn active" data-tab="projects">
                        <i class="fas fa-project-diagram"></i> Projects
                    </button>
                    <button class="tab-btn" data-tab="messages">
                        <i class="fas fa-comments"></i> Messages
                    </button>
                    <button class="tab-btn" data-tab="invoices">
                        <i class="fas fa-file-invoice"></i> Invoices
                    </button>
                </div>
                
                <div id="tab-projects" class="tab-content active">
                    <h3 style="margin-bottom: var(--space-3);">Projects</h3>
                    <div id="client-projects-list">
                        <div class="spinner"></div>
                    </div>
                </div>
                
                <div id="tab-messages" class="tab-content">
                    <h3 style="margin-bottom: var(--space-3);">Messages</h3>
                    <div class="chat-container">
                        <div class="chat-header">
                            <strong>Chat with ${client.name}</strong>
                        </div>
                        <div class="chat-messages" id="client-messages-list">
                            <div class="spinner"></div>
                        </div>
                        <div class="chat-input-container">
                            <input type="text" id="message-input" class="form-control" placeholder="Type a message..." style="flex: 1;">
                            <button class="btn" onclick="sendMessage('${clientId}')">
                                <i class="fas fa-paper-plane"></i> Send
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="tab-invoices" class="tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                        <h3 style="margin: 0;">Invoices</h3>
                        <button class="btn" onclick="createInvoice('${clientId}')">
                            <i class="fas fa-plus"></i> Create Invoice
                        </button>
                    </div>
                    <div id="client-invoices-list">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        `;
        
        // Setup tab switching
        setupClientTabs();
        
        // Load initial tab data
        loadClientProjects(clientId);
        loadClientMessages(clientId);
        loadClientInvoices(clientId);
    };
    
    function setupClientTabs() {
        const tabs = document.querySelectorAll('.tab-btn');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
            });
        });
    }
    
    async function loadClientProjects(clientId) {
        const list = document.getElementById('client-projects-list');
        try {
            const q = query(collection(db, 'projects'), where('clientId', '==', clientId));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: var(--gray-500); text-align: center; padding: var(--space-4);">No projects yet.</p>';
                return;
            }
            
            list.innerHTML = '';
            snapshot.forEach(docSnap => {
                const project = docSnap.data();
                const item = document.createElement('div');
                item.className = 'post-item';
                item.innerHTML = `
                    <div class="post-content">
                        <div class="post-title">${project.name || 'Unnamed Project'}</div>
                        <div class="post-meta">${project.description || 'No description'}</div>
                    </div>
                    <span class="badge badge-${project.status === 'completed' ? 'success' : 'warning'}">${project.status || 'active'}</span>
                `;
                list.appendChild(item);
            });
            } catch (error) {
            console.error('Error loading projects:', error);
            list.innerHTML = '<p style="color: var(--danger);">Error loading projects</p>';
        }
    }
    
    async function loadClientMessages(clientId) {
        const list = document.getElementById('client-messages-list');
        try {
            const q = query(collection(db, 'messages'), 
                where('clientId', '==', clientId), 
                orderBy('timestamp', 'asc'));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: var(--gray-500); text-align: center; padding: var(--space-4);">No messages yet.</p>';
                return;
            }

            list.innerHTML = '';
            snapshot.forEach(docSnap => {
                const message = docSnap.data();
                const bubble = document.createElement('div');
                bubble.className = `message-bubble ${message.sender}`;
                bubble.innerHTML = `
                    ${message.message}
                    <div class="message-time">${message.timestamp ? new Date(message.timestamp.seconds * 1000).toLocaleString() : 'Just now'}</div>
                `;
                list.appendChild(bubble);
            });
            
            // Scroll to bottom
            list.scrollTop = list.scrollHeight;
        } catch (error) {
            console.error('Error loading messages:', error);
            list.innerHTML = '<p style="color: var(--danger);">Error loading messages</p>';
        }
    }
    
    window.sendMessage = async function(clientId) {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        try {
            await addDoc(collection(db, 'messages'), {
                clientId,
                sender: 'admin',
                message,
                timestamp: serverTimestamp(),
                read: false
            });
            
            input.value = '';
            loadClientMessages(clientId);
            showToast('Message sent!', 'success');
        } catch (error) {
            console.error('Error sending message:', error);
            showToast('Error sending message', 'error');
        }
    };
    
    async function loadClientInvoices(clientId) {
        const list = document.getElementById('client-invoices-list');
        try {
            const q = query(collection(db, 'invoices'), where('clientId', '==', clientId), orderBy('date', 'desc'));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                list.innerHTML = '<p style="color: var(--gray-500); text-align: center; padding: var(--space-4);">No invoices yet.</p>';
                return;
            }
            
            list.innerHTML = '';
            snapshot.forEach(docSnap => {
                const invoice = docSnap.data();
                const item = document.createElement('div');
                item.className = 'post-item';
                item.innerHTML = `
                    <div class="stat-icon" style="background: var(--info); opacity: 1;">
                        <i class="fas fa-file-invoice" style="color: var(--white); opacity: 1;"></i>
                    </div>
                    <div class="post-content">
                        <div class="post-title">Invoice #${invoice.invoiceNumber || 'N/A'}</div>
                        <div class="post-meta">${invoice.projectName || 'No project'} â€¢ ${invoice.date ? new Date(invoice.date.seconds * 1000).toLocaleDateString() : 'N/A'}</div>
                    </div>
                    <div style="text-align: right; margin-right: var(--space-3);">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--gray-900);">$${invoice.amount || 0}</div>
                        <span class="badge badge-${invoice.status}">${invoice.status || 'pending'}</span>
                    </div>
                `;
                list.appendChild(item);
            });
            } catch (error) {
            console.error('Error loading invoices:', error);
            list.innerHTML = '<p style="color: var(--danger);">Error loading invoices</p>';
        }
    }
    
    window.createInvoice = function(clientId) {
        showToast('Invoice creation feature - coming soon!', 'info');
    };
    
    // Helper to show clients list card
    window.showClientsList = function() {
        const clientsListCard = document.getElementById('clients-list-card');
        const clientMgmt = document.getElementById('client-management-view');
        if (clientsListCard) clientsListCard.classList.remove('hidden');
        if (clientMgmt) clientMgmt.classList.add('hidden');
    };
    
    // The close button handler is now in admin-client-portal.js
    // It will handle hiding the view and cleaning up listeners
    
    // Refresh button will be handled by admin-client-portal.js setupEventListeners
    // But add a fallback in case the script doesn't load
    const refreshBtn = document.getElementById('refresh-clients-btn');
    if (refreshBtn) {
        // Add a click listener that will be overridden by admin-client-portal.js if it loads
        refreshBtn.addEventListener('click', () => {
            console.log('Refresh clients clicked (fallback)');
            if (window.initAdminClientPortal) {
                console.log('Calling initAdminClientPortal...');
                window.initAdminClientPortal(db, storage);
            } else {
                console.log('Using fallback loadClients...');
                loadClients();
            }
        });
    }
    
    // Expose functions globally
    window.editPost = openPostEditor;
    window.deletePost = deletePost;
    window.savePost = savePost;
    window.closePostEditor = closePostEditor;
    // showToast already exposed earlier
    
    </script>
               
</body>
</html>
